{% extends "base.html" %}

{% block title %}Kategori{% endblock %}

{% block content %}
{% load widget_tweaks %}
<div class="w-full text-gray-800 p-8 bg-gray-50 rounded-md">
    <!-- Header -->
    <div class="flex items-center justify-between border-b border-gray-200 mb-4">
        <div class="text-center md:text-left space-y-2 mb-4">
            <h1 class="text-xl font-semibold text-gray-800">Kategori Produk</h1>
            <p class="text-gray-600 text-sm">Menampilkan informasi kategori produk untuk dimasukkan ke katalog produk
            </p>
        </div>
        <div class="mb-4 flex justify-end space-x-2">
            <a href="{% url 'add_category' %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md 
      text-white bg-blue-600 hover:bg-blue-700 focus:outline-none 
      focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 no-print cursor-pointer">
                <svg class="me-1 -ms-1 w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd"
                        d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                        clip-rule="evenodd"></path>
                </svg>
                Kategori
            </a>
        </div>
    </div>


    <div class="flex flex-row-reverse justify-between items-center mb-4">
        <!-- Search -->
        <input id="searchInput" type="text" placeholder="Cari produk..."
            class="px-3 py-2 border border-gray-300 rounded text-sm">

        <!-- Page Size -->
        <div>
            <span class="text-sm text-gray-600">Tampilkan</span>
            <select id="rowsPerPage" class="px-2 py-1 border border-gray-300 rounded text-sm">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="20">20</option>
            </select>
            <span class="text-sm text-gray-600">entri</span>
        </div>
    </div>
    <div class="overflow-x-auto w-full py-4">
        <table id="records-table" class="table-auto w-full text-sm whitespace-nowrap divide-y divide-gray-200">
            <thead class="bg-gray-100">
                <tr class="bg-gray-50">
                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Nama</th>
                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Deskripsi</th>
                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Aksi</th>
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for category in categories %}
                <tr class="odd:bg-white even:bg-gray-50 hover:bg-gray-100 text-sm">
                    <td class="px-3 py-2 capitalize whitespace-nowrap">{{ category.name }}</td>
                    <td class="px-3 py-2 capitalize whitespace-nowrap">{{ category.description }}</td>
                    <td class="px-3 py-2">
                        <div class="flex items-center space-x-2">
                            <a href="{% url 'edit_category' category.id %}" class="edit-btn hover:text-blue-800 active:text-blue-900
                   font-medium text-sm
                   transition-all duration-200 ease-in-out
                   hover:underline hover:underline-offset-2 cursor-pointer">
                                Edit
                            </a>
                            <!-- Separator -->
                            <span class="text-gray-300">|</span>
                            <a href="{% url 'confirm_delete_category' category.id %}" class="delete-record cursor-pointer
                                            text-red-600 hover:text-red-800 active:text-red-900
                                            font-medium text-sm
                                            py-1
                                            transition-all duration-200 ease-in-out
                                            hover:underline hover:underline-offset-2">
                                Hapus</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- Pagination + Info -->
    <div class="flex flex-col sm:flex-row justify-between items-center mt-4 gap-2">
        <div id="tableInfo" class="text-sm text-gray-600"></div>
        <div id="pagination" class="flex space-x-2"></div>
    </div>

</div>

<!--Swal mixin-->
<script>
    // Mixin untuk toast notifikasi
    const Toast = Swal.mixin({
        toast: true,
        position: "top-end",
        showConfirmButton: false,
        timer: 2500,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.addEventListener("mouseenter", Swal.stopTimer);
            toast.addEventListener("mouseleave", Swal.resumeTimer);
        }
    });
</script>

<!--table-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const table = document.getElementById("records-table");
        const tbody = table.querySelector("tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));
        const searchInput = document.getElementById("searchInput");
        const rowsPerPageSelect = document.getElementById("rowsPerPage");
        const pagination = document.getElementById("pagination");
        const tableInfo = document.getElementById("tableInfo");

        let currentPage = 1;
        let rowsPerPage = parseInt(rowsPerPageSelect.value);
        let filteredRows = [...rows];
        let sortDirection = 1; // 1 = asc, -1 = desc

        function renderTable() {
            tbody.innerHTML = "";

            if (filteredRows.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-gray-500">Data tidak ditemukan</td></tr>`;
                tableInfo.textContent = "Showing 0 to 0 of 0 entries";
                pagination.innerHTML = "";
                return;
            }

            const start = (currentPage - 1) * rowsPerPage;
            const end = Math.min(start + rowsPerPage, filteredRows.length);

            filteredRows.slice(start, end).forEach(row => tbody.appendChild(row));

            tableInfo.textContent = `Showing ${start + 1} to ${end} of ${filteredRows.length} entries`;
            renderPagination();
        }

        function renderPagination() {
            pagination.innerHTML = "";
            const totalPages = Math.ceil(filteredRows.length / rowsPerPage);

            if (totalPages <= 1) return;

            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement("button");
                btn.textContent = i;
                btn.className = `px-3 py-1 rounded ${i === currentPage ? "bg-blue-600 text-white" : "bg-gray-200 text-gray-700 hover:bg-gray-300"
                    }`;
                btn.addEventListener("click", () => {
                    currentPage = i;
                    renderTable();
                });
                pagination.appendChild(btn);
            }
        }

        // Search filter
        searchInput.addEventListener("input", function () {
            const term = this.value.toLowerCase();
            filteredRows = rows.filter(row => row.textContent.toLowerCase().includes(term));
            currentPage = 1;
            renderTable();
        });

        // Change rows per page
        rowsPerPageSelect.addEventListener("change", function () {
            rowsPerPage = parseInt(this.value);
            currentPage = 1;
            renderTable();
        });

        // Sorting
        table.querySelectorAll("th[data-sort]").forEach(th => {
            th.addEventListener("click", function () {
                const colIndex = parseInt(this.dataset.sort);
                sortDirection *= -1; // toggle asc/desc
                filteredRows.sort((a, b) => {
                    const textA = a.children[colIndex].textContent.trim();
                    const textB = b.children[colIndex].textContent.trim();
                    return textA.localeCompare(textB, undefined, { numeric: true }) * sortDirection;
                });
                currentPage = 1;
                renderTable();
            });
        });

        // Init
        renderTable();
    });
</script>





{% endblock %}