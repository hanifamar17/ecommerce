{% extends "base.html" %}

{% block title %}Hapus kategori?{% endblock %}

{% block content %}
{% load widget_tweaks %}
<div class="w-full text-gray-800 p-8 bg-gray-50 rounded-md">
    <!-- Header -->
    <div class="flex items-center justify-between border-b border-gray-200 mb-4">
        <div class="text-center md:text-left space-y-2 mb-4">
            <h1 class="text-xl font-semibold text-gray-800">Hapus Kategori</h1>
            <p class="text-gray-600 text-sm">Apakah kamu yakin ingin menghapus kategori <strong>{{ category.name }}</strong>?
            </p>
        </div>
    </div>

    <form id="categoryForm" action="{% url 'delete_category' category.id %}" method="post">
        {% csrf_token %}
        <div class="mt-4 flex justify-start gap-3">
            <a href="{% url 'category_list' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md 
      text-gray hover:bg-gray-100 focus:outline-none 
      focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 no-print cursor-pointer">Batal</a>

            <button id="submitBtn" type="submit"
                class="bg-rose-100 text-rose-600 hover:bg-rose-200 transition-colors inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md cursor-pointer">
                <span id="btnText">
                    Hapus
                </span>
                <svg id="btnSpinner" class="hidden ml-2 w-4 h-4 text-white animate-spin"
                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
            </button>
        </div>
    </form>

    <!-- Container Toast -->
    <div id="toast-container" class="fixed top-5 right-5 z-50 space-y-2 overflow-hidden"></div>
</div>

<!-- Button Loading State -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("categoryForm");
        const submitBtn = document.getElementById("submitBtn");
        const btnText = document.getElementById("btnText");
        const btnSpinner = document.getElementById("btnSpinner");

        form.addEventListener("submit", function () {
            submitBtn.disabled = true;
            btnText.textContent = "Menghapus...";
            btnSpinner.classList.remove("hidden");
        });
    });
</script>

<!-- toast -->
<script>
    document.getElementById("categoryForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        const response = await fetch(form.action, {
            method: "POST",
            body: formData,
            headers: { "X-Requested-With": "XMLHttpRequest" }
        });

        const data = await response.json();
        if (data.status === "success") {
            showToast("success", data.message);

            setTimeout(() => {
                window.location.href = "{% url 'category_list' %}";
            }, 1500);
        } else {
            showToast("error", data.message || "Terjadi kesalahan, periksa input!");
        }
    });

    // Helper function buat bikin toast
    function showToast(type, message) {
        const container = document.getElementById("toast-container");

        // buat element toast
        const toast = document.createElement("div");
        toast.className = `flex items-center w-full max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow-sm transition-all duration-500 ease-in-out transform translate-x-full opacity-0`;
        toast.role = "alert";

        const icon = type === "success"
            ? `<div class="inline-flex items-center justify-center shrink-0 w-8 h-8 text-green-500 bg-green-100 rounded-lg">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z"/></svg>
           </div>`
            : `<div class="inline-flex items-center justify-center shrink-0 w-8 h-8 text-red-500 bg-red-100 rounded-lg">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 11.793a1 1 0 1 1-1.414 1.414L10 11.414l-2.293 2.293a1 1 0 0 1-1.414-1.414L8.586 10 6.293 7.707a1 1 0 0 1 1.414-1.414L10 8.586l2.293-2.293a1 1 0 0 1 1.414 1.414L11.414 10l2.293 2.293Z"/></svg>
           </div>`;

        toast.innerHTML = `
        ${icon}
        <div class="ms-3 text-sm font-normal">${message}</div>
        <button type="button" class="ms-auto -mx-1.5 -my-1.5 text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100">
            <svg class="w-3 h-3" fill="none" viewBox="0 0 14 14"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/></svg>
        </button>
    `;

        // tombol close
        toast.querySelector("button").addEventListener("click", () => {
            hideToast(toast);
        });

        container.appendChild(toast);

        // animasi masuk
        setTimeout(() => {
            toast.classList.remove("translate-x-full", "opacity-0");
            toast.classList.add("translate-x-0", "opacity-100");
        }, 50);

        // auto hide
        setTimeout(() => {
            hideToast(toast);
        }, 2500);
    }

    function hideToast(toast) {
        toast.classList.remove("translate-x-0", "opacity-100");
        toast.classList.add("translate-x-full", "opacity-0");
        setTimeout(() => toast.remove(), 600);
    }
</script>
{% endblock %}