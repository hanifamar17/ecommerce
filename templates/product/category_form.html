{% extends "base.html" %}

{% block title %}Kategori Form{% endblock %}

{% block content %}
{% load widget_tweaks %}
<div class="w-full text-gray-800 p-8 bg-gray-50 rounded-md">
    <!-- Header -->
    <div class="flex items-center justify-between border-b border-gray-200 mb-4">
        <div class="text-center md:text-left space-y-2 mb-4">
            <h1 class="text-xl font-semibold text-gray-800">{% if category %}Edit Kategori{% else %}Tambah
                Kategori{%endif %}</h1>
            <p class="text-gray-600 text-sm">{% if category %}Edit{% else %}Tambah{% endif %} informasi kategori produk
                untuk dimasukkan ke katalog produk
            </p>
        </div>
    </div>

    <div class="flex md:flex-row mt-8">
        <div class="md:w-1/2">
            <h1 class="text-gray-800">Informasi Kategori</h1>
            <p class="text-gray-600 text-sm">Pastikan informasi kategori yang dimasukkan benar</p>
        </div>

        <div class="md:w-1/2">
            <form id="categoryForm" method="post" enctype="multipart/form-data"
                action="{% if category %}{% url 'edit_category' category.id %}{% else %}{% url 'add_category' %}{% endif %}">
                {% csrf_token %}

                <!-- Nama -->
                <div class="mb-4">
                    <label for="{{ form.name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        Nama Kategori
                    </label>
                    {{ form.name }}
                    {% if form.name.errors %}
                    <p class="text-sm text-red-600 mt-1">{{ form.name.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Deskripsi -->
                <div class="mb-4">
                    <label for="{{ form.description.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                        Deskripsi
                    </label>
                    {{ form.description }}
                    {% if form.description.errors %}
                    <p class="text-sm text-red-600 mt-1">{{ form.description.errors.0 }}</p>
                    {% endif %}
                </div>

                <div class="flex justify-end gap-2 mt-4">
                    <a href="{% url 'category_list' %}"
                        class="px-4 py-2 bg-gray-200 rounded-md text-gray-700 hover:bg-gray-300">
                        Batal
                    </a>
                    {% if category %}
                    <button type="submit"
                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium 
             rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none 
             focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="me-1 -ms-1 w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                        </svg>
                        Perbarui
                    </button>
                    {% else %}
                    <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium 
             rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none 
             focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer">
                        <svg class="me-1 -ms-1 w-5 h-5" fill="currentColor" viewBox="0 0 20 20"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
                                clip-rule="evenodd"></path>
                        </svg>
                        Simpan
                    </button>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>

<!--Swal mixin-->
<script>
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
    });

    document.getElementById("categoryForm").addEventListener("submit", function (e) {
        e.preventDefault();

        let form = e.target;
        let url = form.action;
        let formData = new FormData(form);

        fetch(url, {
            method: "POST",
            body: formData,
            headers: { "X-Requested-With": "XMLHttpRequest" }
        })
            .then(res => res.json())
            .then(data => {
                if (data.status === "success") {
                    Toast.fire({ icon: "success", title: data.message });
                    setTimeout(() => { window.location.href = "{% url 'category_list' %}"; }, 1200);
                } else {
                    Toast.fire({ icon: "error", title: data.message });
                    console.error(data.errors);
                }
            })
            .catch(() => {
                Toast.fire({ icon: "error", title: "Terjadi kesalahan!" });
            });
    });
</script>
{% endblock %}